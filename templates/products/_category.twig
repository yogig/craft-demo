{% extends "_layout" %}

{% block title %}{{ category.title }} - Products - {{ siteName }}{% endblock %}

{% block content %}
    <h1>{{ category.title }}</h1>

    <p style="font-size: 18px; color: #666; margin: 20px 0 40px;">
        Browse products in this category
    </p>

    {% set categoryProducts = craft.entries()
        .section('products')
        .relatedTo(category)
        .orderBy('postDate DESC')
        .all() %}

    {% if categoryProducts|length %}
        <div class="blog-grid">
            {% for entry in categoryProducts %}
                <div class="blog-card">
                    {% set productImage = entry.productImage.one() %}
                    {% if productImage %}
                        <img src="{{ productImage.url }}"
                             alt="{{ productImage.title }}">
                    {% else %}
                        <img src="https://via.placeholder.com/400x200/27ae60/ffffff?text={{ entry.title|url_encode }}"
                             alt="{{ entry.title }}">
                    {% endif %}

                    <div class="blog-card-content">
                        <h2><a href="{{ entry.url }}">{{ entry.title }}</a></h2>

                        {% if entry.productDescription %}
                            <p class="summary">{{ entry.productDescription|slice(0, 100) }}...</p>
                        {% endif %}

                        {% if entry.price %}
                            <p style="font-size: 24px; font-weight: bold; color: #27ae60; margin: 15px 0;">
                                ${{ entry.price|number_format(2) }}
                            </p>
                        {% endif %}

                        <a href="{{ entry.url }}" class="btn">View Details →</a>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p style="color: #666; text-align: center; padding: 40px;">
            No products in this category yet.
        </p>
    {% endif %}

    <p style="margin-top: 40px;">
        <a href="{{ url('products') }}" class="btn">← Back to All Products</a>
    </p>
{% endblock %}